<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pong Game</title>
</head>
<style>
    #fullGame{
        text-align: center;
    }
    #gameBoard{
        border: 6px solid slateblue;
    }
    #scoreBoard{
        font-size: 60px;
        font-family: consolas;
    }
    button{
        height: 40px;
        width: 100px;
        font-size: 20px;
        /* border: 2px solid black; */
        border-radius: 12px;
    }
</style>
<body>
<div id="fullGame">
    <canvas id="gameBoard" width="400" height="400"></canvas>

    <p id="scoreBoard">0 : 0</p>
    <button>Restart</button>
</div>

<script>

const gameBoard = document.querySelector("#gameBoard");
const context = gameBoard.getContext("2d");

const Restart = document.querySelector("button");
const scoreBoard = document.querySelector("#scoreBoard");

const gameWidth = gameBoard.width;
const gameHeight = gameBoard.height;

const gameBoardColor = "forestgreen";
const padder1Color = "red";
const padder2Color = "skyblue";
const padderBorderColor = "black";
const ballColor = "white";
const ballBorderColor = "black";

let player1Score = 0;
let player2Score = 0;

let paddle1 = {width: 15, height: 60, x:0, y:0};
let paddle2 = {width: 15, height: 60, x:gameWidth - 15, y:gameHeight - 60};

let ballX = gameWidth/2;
let ballY = gameHeight/2;

const ballRadius = 10;
let ballSpeed = 1;
let paddleSpeed = 40;
let ballMovesX = 0;
let ballMovesY = 0;

let interval;
startGame();

function startGame(){
    createBall();
    nextStep();
}

function nextStep(){
    interval= setTimeout(() =>{
        clearBoard();
        displayPaddles();
        moveBall();
        displayBall(ballX, ballY);
        checkBallHitting();

        nextStep();
    }, 10);
}

window.addEventListener("keydown", changePaddlesDirection);
Restart.addEventListener("click", RestartGame);

function createBall(){
    ballSpeed = 1;

    if(Math.round(Math.random())== 1){
        ballMovesX = ballSpeed;
    }
    else{
        ballMovesX = -ballSpeed;
    }

    if(Math.round(Math.random()) == 1){
        ballMovesY = -ballSpeed;
    }
    else{
        ballMovesY = (ballSpeed);
    }

    ballX = gameWidth/2;
    ballY = gameWidth/2;

    displayBall(ballX, ballY);
}

function displayBall(ballX, ballY){
    context.fillStyle = ballColor;
    context.strokeStyle = ballBorderColor;
    context.beginPath();
    context.lineWidth= 2;
    context.arc(ballX, ballY, ballRadius, 0, 2 * Math.PI);
    context.fill();
    context.stroke();
}

function clearBoard(){
    context.fillStyle = gameBoardColor;
    context.fillRect(0, 0, gameWidth, gameHeight)
}

function displayPaddles(){
    context.strokeStyle = padderBorderColor;

    context.fillStyle = padder1Color;
    context.fillRect(paddle1.x, paddle1.y, paddle1.width, paddle1.height);
    context.strokeRect(paddle1.x, paddle1.y, paddle1.width, paddle1.height);
    
    context.fillStyle = padder2Color;
    context.fillRect(paddle2.x, paddle2.y, paddle2.width, paddle2.height);
    context.strokeRect(paddle2.x, paddle2.y, paddle2.width, paddle2.height);
}

function moveBall(){
    ballX += ballSpeed * ballMovesX;
    ballY += ballSpeed * ballMovesY;
}

function changePaddlesDirection(event){
    const keyPressed = event.keyCode;

    const W = 87;
    const S = 83;
    const Up = 38;
    const Down = 40;

    switch (keyPressed) {
        case (W):
        if (paddle1.y > 0) {
            paddle1.y -= paddleSpeed;
            if (paddle1.y < 0) {
                paddle1.y =0;
            }
        }
        break;
        
        case (S):
        if (paddle1.y < gameHeight -paddle1.height) {
            paddle1.y += paddleSpeed;
            if(paddle1.y > (gameHeight - paddle1.height)){
                paddle1.y = (gameHeight - paddle2.height);
            }
        }
        break;

        case (Up): 
        if (paddle2.y > 0) {
            paddle2.y -= paddleSpeed;
            if (paddle2.y < 0) {
                paddle2.y = 0;
            }
        }
        break;

        case (Down): 
        if (paddle2.y < gameHeight - paddle2.height) {
            paddle2.y += paddleSpeed;
            if(paddle2.y > (gameHeight - paddle2.height)){
                paddle2.y = (gameHeight - paddle2.height);
            }
        }
        break;        
    }
}

// function checkBallHitting(){
//     if (ballY < 0 + ballRadius) {
//         ballMovesY *= -1;
//     }
//     else if(ballY > gameHeight - ballRadius){
//         ballMovesY *= -1;
//     }
//      if (ballX < 0) {
//         player2Score +=1;
//         updateScoreBoard();
//         createBall();    
//         return;   

//     }
//     else if(ballX > gameWidth){
//         player1Score +=1;
//         updateScoreBoard();
//         createBall();   
//         return;    
//     }

//     //if the ball hits paddle
//     if(ballX <= paddle1.x +paddle1.width + ballRadius){
//         if (ballY >= paddle1.y  && ballY <= paddle1.y + paddle1.height) {
//             // ballX = paddle1.x +paddle1.width + ballRadius;
//             ballMovesX *= -1 ;
//             ballSpeed +=0.1;
//         }
//     } 
//     if(ballX >= paddle2.x - ballRadius){
//         if (ballY >= paddle2.y  && ballY <= paddle2.y + paddle2.height) {
//             ballY = paddle2.y +paddle2.width + ballRadius;
//             ballMovesX *= -1;
//             ballSpeed 
//         }
//     }
// }

function checkBallHitting() {
    // check if the ball hits the top or bottom wall
    if (ballY - ballRadius < 0 || ballY + ballRadius > gameHeight) {
        ballMovesY = -ballMovesY;
    }

        if (ballX < 0) {
            player2Score +=1;
            updateScoreBoard();
            createBall();    
            return;   

        }
         else if(ballX > gameWidth){
            player1Score +=1;
            updateScoreBoard();
            createBall();   
            return;    
    // check if the ball hits the left paddle
    if (ballX - ballRadius <= paddle1.x + paddle1.width && ballY >= paddle1.y && ballY <= paddle1.y + paddle1.height) {
        ballMovesX = 1;
    }

    // check if the ball hits the right paddle
    if (ballX + ballRadius >= paddle2.x && ballY >= paddle2.y && ballY <= paddle2.y + paddle2.height) {
        ballMovesX = -1;
    }
}
}

// function moveBall() {
//     ballX += ballSpeed * ballMovesX;
//     ballY += ballSpeed * ballMovesY;

//     // check if the ball hits the left or right paddle
//     if (ballX - ballRadius <= paddle1.x + paddle1.width && ballY >= paddle1.y && ballY <= paddle1.y + paddle1.height ||
//         ballX + ballRadius >= paddle2.x && ballY >= paddle2.y && ballY <= paddle2.y + paddle2.height) {
//         ballSpeed += 0.1;
//         ballMovesX = -ballMovesX;
//     }
// }


function RestartGame(){
 player1Score = 0;
 player2Score = 0;

 paddle1 = {width: 15, height: 60, x:0, y:0};
 paddle2 = {width: 15, height: 60, x:gameWidth - 15, y:gameHeight - 60};

 ballX = gameWidth/2;
 ballY = gameHeight/2;

 ballSpeed = 1;
 paddleSpeed = 40;
 ballMovesX = 0;
 ballMovesY = 0;

 updateScoreBoard();
clearTimeout(interval);
startGame();
}

function updateScoreBoard(){
    scoreBoard.textContent = `${player1Score} : ${player2Score}`;
}
</script>
</body>
</html>